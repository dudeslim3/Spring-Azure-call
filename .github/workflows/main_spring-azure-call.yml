name: Build and deploy JAR file on Azure Microsoft
on:
  push:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Java environment
        uses: actions/setup-java@v1
        with:
          java-version: '17'
      - name: Build with Maven
        run: mvn package -DoutputDirectory=target/build

      - name: Upload artifact to Azure Blob Storage
        uses: azure/CLI@v1
        with:
          inlineScript: |
            az storage blob upload-batch --destination "<container-name>" --source "target/*.jar" --pattern "*.jar" --account-name "<storage-account-name>" --account-key "<storage-account-key>"
      - name: Deploy to Azure Web App
        uses: azure/webapps-deploy@v2
        with:
          app-name: "Spring-Azure-call"
          slot-name: "Production"
          publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISHPROFILE_7462F88167D04D2092FE2D54C3AEED39 }}
          package: "<container-name>/*.jar"
